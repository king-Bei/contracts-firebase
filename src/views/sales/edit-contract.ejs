<%- include('../partials/header') %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">編輯合約</h1>
    <p class="text-muted mb-0">合約 ID：<%= contract.id %></p>
  </div>
  <a href="/sales/contracts/<%= contract.id %>" class="btn btn-outline-secondary">返回詳情</a>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <form action="/sales/contracts/<%= contract.id %>/edit" method="POST">
      <div class="mb-3">
        <label for="client_name" class="form-label">客戶姓名</label>
        <input type="text" id="client_name" name="client_name" class="form-control" value="<%= contract.client_name || '' %>" required>
      </div>

      <% if (templateVariables && templateVariables.length > 0) { %>
        <div class="border rounded p-3 mb-3 bg-light">
          <h6 class="mb-3">合約變數</h6>
          <% templateVariables.forEach(variable => { const key = variable.key || variable.name; const value = (contract.variable_values || {})[key]; %>
            <div class="mb-3">
              <label class="form-label" for="var-<%= key %>"><%= variable.label || variable.name %></label>
              <% if (variable.type === 'textarea') { %>
                <textarea class="form-control" id="var-<%= key %>" name="variables[<%= key %>]" rows="3"><%= value || '' %></textarea>
              <% } else { %>
                <input type="text" class="form-control" id="var-<%= key %>" name="variables[<%= key %>]" value="<%= value || '' %>">
              <% } %>
            </div>
          <% }) %>
          <p class="text-muted small mb-0">變數將套入範本中的 <code>{{key}}</code> 位置。</p>
        </div>
      <% } %>

      <div class="d-flex justify-content-end gap-2">
        <a href="/sales/contracts/<%= contract.id %>" class="btn btn-secondary">取消</a>
        <button type="submit" class="btn btn-primary">儲存變更</button>
      </div>
    </form>
  </div>
</div>

<%- include('../partials/footer') %>
