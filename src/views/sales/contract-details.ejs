<%- include('../partials/header') %>
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">合約詳情</h1>
    <p class="text-muted mb-0">合約 ID：<%= contract.id %></p>
  </div>
  <div>
    <a href="/sales" class="btn btn-outline-secondary">返回列表</a>
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-5">
    <div class="card shadow-sm mb-4">
      <div class="card-header">
        <strong>合約資訊</strong>
      </div>
      <div class="card-body">
        <p class="mb-2"><strong>客戶名稱：</strong><%= contract.client_name || '-' %></p>
        <p class="mb-2"><strong>範本：</strong><%= contract.template_name %></p>
        <p class="mb-2"><strong>狀態：</strong>
          <% if (contract.status === 'SIGNED') { %>
            <span class="badge bg-success">已簽署</span>
          <% } else if (contract.status === 'PENDING_SIGNATURE') { %>
            <span class="badge bg-warning text-dark">待簽署</span>
          <% } else { %>
            <span class="badge bg-secondary"><%= contract.status %></span>
          <% } %>
        </p>
        <p class="mb-2"><strong>建立時間：</strong><%= new Date(contract.created_at).toLocaleString() %></p>
        <% if (contract.signed_at) { %>
          <p class="mb-0"><strong>簽署時間：</strong><%= new Date(contract.signed_at).toLocaleString() %></p>
        <% } %>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>簽署資訊</strong>
      </div>
      <div class="card-body">
        <p class="mb-2">請將以下連結與驗證碼提供給客戶。</p>
        <div class="mb-3">
          <label class="form-label">簽署連結</label>
          <input type="text" readonly class="form-control" value="<%= shareLink %>">
        </div>
        <% if (plaintextCode) { %>
          <div class="alert alert-success" role="alert">
            <strong>客戶驗證碼：</strong> <kbd><%= plaintextCode %></kbd>
            <div class="small text-muted mt-2">驗證碼僅顯示一次，請妥善保存。</div>
          </div>
        <% } else { %>
          <div class="alert alert-warning" role="alert">
            驗證碼已隱藏。如需再次取得，請聯繫系統管理員重新產生合約。
          </div>
        <% } %>
      </div>
    </div>
  </div>

  <div class="col-lg-7">
    <div class="card shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>合約內容預覽</strong>
      </div>
      <div class="card-body">
        <div class="border rounded p-3 bg-light" style="min-height: 240px; white-space: pre-wrap;">
          <%- previewContent %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../partials/footer') %>
